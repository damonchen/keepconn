
## 背景

在网络的分布式领域中，存在这么一类问题，即被控制的机器只有一台，
这台机器就是工作的机器，所有的任务，都在这台机器上处理。

我们将控制远程其他机器的机器称为服务器（server），被控制的机器称为客户端（client）

## 问题

和后台常说的分布式集群不一样的是，这台被控制的机器，不存在集群，仅此一台，因此
当我们有另外一台机器，通过网络和这台机器进行通讯的时候，我们就非常迫切
期望通讯的信息是可靠且准确的：

1. 消息发送过去了
2. 消息被消费了
3. 消息没有丢失


显然，我们期望，消息被可靠送达到被控机器上的时候，该机器仅能消费该消息一次，消息不能
被消费多于一次，也不能被消费少于一次，因此，我们需要在被控机器上，控制消息的状态，
其状态应当为：

- 开始接受消息
- 正在接受中
- 接受完毕
- 正在消费中
- 消费完毕
- 结束消息

但实际网络中，存在以下几个因子的影响：

1. 由于存在网络抖动的原因，被控机器上的消息在某个状态的时候，网络断了，被控机器
仍旧会按照预先设定的程序规则往前进行，但服务器端并不清楚被控机器中进行到何种状态，
服务器端只能等待一段时间，发现客户端已经断开了链接，只能设计自身状态为超时，并
等待最终结果。

2. 被控机器由于断电等一些特殊原因（不可检测），导致程序也挂了，最后网络也断了，
服务器端并不清楚被控机器中进行到何种状态，只能设计自己为超时状态，
客户端重启后，也不确定程序应该从哪个步骤开始


3. 由于磁盘满、内存满等一些可检测因子，导致程序挂了，网络也断了，
服务器端并不清楚被控机器中进行到何种状态，只能设计自己为超时状态，
客户端重启后，也不确定程序应该从哪个步骤开始。


### 解决方案



